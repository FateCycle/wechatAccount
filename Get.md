## 微信

### 公众号

#### 开发流程

#### API理解

+ 自定义菜单和个性化菜单

  1. 自定义菜单为默认的一些菜单，个性化菜单是当符合传入的匹配规则后把之前的默认菜单或先前的个性化菜单进行替换，所以个性化菜单一定要有默认菜单存在才能创建
2. 当然个性化菜单可以多次创建并且可以覆盖原来的只要他所在的条件被当前用户所满足，所有个性化菜单都会存放到conditionalmenu数组中，并且根据定义先后以及条件是否满足来决定是否渲染，越晚定义(创建)优先级越高，只有通过删除才能删除他
  3. 菜单的key可以被EventKey所监听，这样就能处理点击事件了

+ 网页授权流程：

  1. 访问自己应用授权接口，接口重定向到微信官方授权页面(要传入**下次重定向路径**，认证类型和业务参数)

  2. 点击官方页面的按钮，系统自动跳转到之前传入的重定向路径并且会在URL上加上code变量

  3. 在自己的应用接口捕获自己设置路径并拿到code，向微信API发起请求，拿到access_token和openId

     注意access_token和全局请求用的参数access_token不是一个东西，仅仅重名而已，这里的是用来授权的

  4. 使用access_token和openId 再请求微信API得到用户信息，放在body中前台渲染，由于没有跳转最后显示的用户信息就是自己所重定向的路径页面

+  JS-SDK授权

  1. 访问自己应用的授权接口，然后向数据库查找access_token(过期了再向微信请求更新)
  2. 使用access_token向微信申请jsapi_ticket
  3. 获取当前页面的完整路径(ctx.href),**不要使用ctx.url它只能获取根路径下的地址**
  4. 然后自己定义一个随机字符串和时间戳，将两项,jsapi_ticket和url根据key排序并连接成url路径参数形式
  5. 将字符串进行加密，然后返回随机字符串,时间戳,加密字符串
  6. 填写到页面wx.config中，**特别注意value是字符串形式一定要加上引号**
  7. 授权成功后wx.ready({})会马上执行







